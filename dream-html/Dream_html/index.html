<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dream_html (dream-html.Dream_html)</title><link rel="stylesheet" href="../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../index.html">dream-html</a> &#x00BB; Dream_html</nav><header class="odoc-preamble"><h1>Module <code><span>Dream_html</span></code></h1><p>Constructing HTML. Detailed explanation in <a href="https://github.com/yawaramin/dream-html">https://github.com/yawaramin/dream-html</a>.</p><p>Let's adapt the example from the <a href="https://aantron.github.io/dream/">Dream home page</a>:</p><pre><code>let hello who =
  let open Dream_html in
  let open Tag in
  html [] [body [] [h1 [] [txt &quot;Hello, %s!&quot; who]]]

let () =
  Dream.run
  @@ Dream.logger
  @@ Dream.router [Dream.get &quot;/&quot; (fun _ -&gt; Dream_html.respond (hello &quot;world&quot;))]</code></pre><p>More examples shown below.</p></header><nav class="odoc-toc"><ul><li><a href="#core-types">Core types</a></li><li><a href="#output">Output</a></li><li><a href="#constructing-nodes-and-attributes">Constructing nodes and attributes</a></li><li><a href="#accessors-for-tags">Accessors for tags</a></li><li><a href="#standard-attributes">Standard attributes</a></li><li><a href="#standard-tags">Standard tags</a></li><li><a href="#htmx-attributes">htmx attributes</a></li><li><a href="#interop-example–markdown-to-html">Interop example–Markdown to HTML</a></li></ul></nav><div class="odoc-content"><h3 id="core-types"><a href="#core-types" class="anchor"></a>Core types</h3><p>These are the types of the final values which get rendered.</p><div class="odoc-spec"><div class="spec type" id="type-attr" class="anchored"><a href="#type-attr" class="anchor"></a><code><span><span class="keyword">type</span> attr</span></code></div><div class="spec-doc"><p>E.g. <code>id=&quot;toast&quot;</code>.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-node" class="anchored"><a href="#type-node" class="anchor"></a><code><span><span class="keyword">type</span> node</span></code></div><div class="spec-doc"><p>Either a tag, a comment, or text data in the markup.</p></div></div><h3 id="output"><a href="#output" class="anchor"></a>Output</h3><div class="odoc-spec"><div class="spec value" id="val-to_string" class="anchored"><a href="#val-to_string" class="anchor"></a><code><span><span class="keyword">val</span> to_string : <span><a href="#type-node">node</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-pp" class="anchored"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-node">node</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-respond" class="anchored"><a href="#val-respond" class="anchor"></a><code><span><span class="keyword">val</span> respond : 
  <span>?status:<span>[&lt; <span class="xref-unresolved">Dream</span>.status ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?code:int <span class="arrow">&#45;&gt;</span></span>
  <span>?headers:<span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-node">node</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Dream</span>.response <span class="xref-unresolved">Dream</span>.promise</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-set_body" class="anchored"><a href="#val-set_body" class="anchor"></a><code><span><span class="keyword">val</span> set_body : <span><span class="xref-unresolved">Dream</span>.response <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-node">node</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Type-safe wrapper for <code>Dream.set_body</code>. Sets the body to the given <code>node</code> and sets the <code>Content-Type</code> header to <code>text/html</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-write" class="anchored"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : <span><span class="xref-unresolved">Dream</span>.stream <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-node">node</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Dream</span>.promise</span></span></code></div><div class="spec-doc"><p>Type-safe wrapper for <code>Dream.write</code>.</p></div></div><h3 id="constructing-nodes-and-attributes"><a href="#constructing-nodes-and-attributes" class="anchor"></a>Constructing nodes and attributes</h3><div class="odoc-spec"><div class="spec type" id="type-to_attr" class="anchored"><a href="#type-to_attr" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a to_attr</span></span><span> = <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-attr">attr</a></span></code></div><div class="spec-doc"><p>Attributes can be created from typed values.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-string_attr" class="anchored"><a href="#type-string_attr" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a string_attr</span></span><span> = <span><span><span>( <span class="type-var">'a</span>, unit, string, <a href="#type-attr">attr</a> )</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Special handling for string-value attributes so they can use format strings i.e. string interpolation.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-std_tag" class="anchored"><a href="#type-std_tag" class="anchor"></a><code><span><span class="keyword">type</span> std_tag</span><span> = <span><span><a href="#type-attr">attr</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-node">node</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-node">node</a></span></code></div><div class="spec-doc"><p>A 'standard' tag with attributes and children.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-void_tag" class="anchored"><a href="#type-void_tag" class="anchor"></a><code><span><span class="keyword">type</span> void_tag</span><span> = <span><span><a href="#type-attr">attr</a> list</span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-node">node</a></span></code></div><div class="spec-doc"><p>A 'void element': <a href="https://developer.mozilla.org/en-US/docs/Glossary/Void_element">https://developer.mozilla.org/en-US/docs/Glossary/Void_element</a> with no children.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-text_tag" class="anchored"><a href="#type-text_tag" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a text_tag</span></span><span> = <span><span><a href="#type-attr">attr</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>( <span class="type-var">'a</span>, unit, string, <a href="#type-node">node</a> )</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Tags which can have attributes but can contain only text. The text can be formatted.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string_attr" class="anchored"><a href="#val-string_attr" class="anchor"></a><code><span><span class="keyword">val</span> string_attr : <span>string <span class="arrow">&#45;&gt;</span></span> <span>?raw:bool <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">_</span> <a href="#type-string_attr">string_attr</a></span></span></code></div><div class="spec-doc"><p><code>string_attr name fmt</code> is a new string-valued attribute which allows formatting i.e. string interpolation of the value. Note, the <code>fmt</code> argument is required due to the value restriction.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">raw</span> <p>(default <code>false</code>) whether to inject the raw text or to escape it. Note that Dream does not support escaping inline JavaScript nor CSS, so neither does dream-html: <a href="https://github.com/aantron/dream/tree/master/example/7-template#security">https://github.com/aantron/dream/tree/master/example/7-template#security</a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-uri_attr" class="anchored"><a href="#val-uri_attr" class="anchor"></a><code><span><span class="keyword">val</span> uri_attr : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">_</span> <a href="#type-string_attr">string_attr</a></span></span></code></div><div class="spec-doc"><p>Convenience for attributes whose values should be URIs. Takes care of URI- encoding.</p><pre><code>a [href &quot;/blog?tags=iamsafe\&quot;&gt;&lt;/a&gt;&lt;script&gt;alert('Pwned')&lt;/script&gt;&quot;] [txt &quot;Tags: tag1 | tag2&quot;]</code></pre><p>Output:</p><pre><code>&lt;a href=&quot;/blog?tags=iamsafe%22%3E%3C/a%3E%3Cscript%3Ealert('Pwned')%3C/script%3E&quot;&gt;Tags: tag1 | tag2&lt;/a&gt;</code></pre></div></div><div class="odoc-spec"><div class="spec value" id="val-bool_attr" class="anchored"><a href="#val-bool_attr" class="anchor"></a><code><span><span class="keyword">val</span> bool_attr : <span>string <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-to_attr">to_attr</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-float_attr" class="anchored"><a href="#val-float_attr" class="anchor"></a><code><span><span class="keyword">val</span> float_attr : <span>string <span class="arrow">&#45;&gt;</span></span> <span>float <a href="#type-to_attr">to_attr</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-int_attr" class="anchored"><a href="#val-int_attr" class="anchor"></a><code><span><span class="keyword">val</span> int_attr : <span>string <span class="arrow">&#45;&gt;</span></span> <span>int <a href="#type-to_attr">to_attr</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-std_tag" class="anchored"><a href="#val-std_tag" class="anchor"></a><code><span><span class="keyword">val</span> std_tag : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-std_tag">std_tag</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-void_tag" class="anchored"><a href="#val-void_tag" class="anchor"></a><code><span><span class="keyword">val</span> void_tag : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-void_tag">void_tag</a></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-text_tag" class="anchored"><a href="#val-text_tag" class="anchor"></a><code><span><span class="keyword">val</span> text_tag : <span>string <span class="arrow">&#45;&gt;</span></span> <span>?raw:bool <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">_</span> <a href="#type-text_tag">text_tag</a></span></span></code></div><div class="spec-doc"><p>Build a tag which can contain only text.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">raw</span> <p>(default <code>false</code>) whether to inject the raw text or to escape it. Note that Dream does not support escaping inline JavaScript nor CSS, so neither does dream-html: <a href="https://github.com/aantron/dream/tree/master/example/7-template#security">https://github.com/aantron/dream/tree/master/example/7-template#security</a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-txt" class="anchored"><a href="#val-txt" class="anchor"></a><code><span><span class="keyword">val</span> txt : <span>?raw:bool <span class="arrow">&#45;&gt;</span></span> <span><span><span>( <span class="type-var">'a</span>, unit, string, <a href="#type-node">node</a> )</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>A text node inside the DOM e.g. the 'hi' in <code>&lt;b&gt;hi&lt;/b&gt;</code>. Allows string interpolation using the same formatting features as <code>Printf.sprintf</code>:</p><pre><code>b [] [txt &quot;Hello, %s!&quot; name]</code></pre><p>Or without interpolation:</p><pre><code>b [] [txt &quot;Bold of you.&quot;]</code></pre><p>HTML-escapes the text value using <code>Dream.html_escape</code>. You can use the <code>~raw</code> param to bypass escaping:</p><pre><code>let user_input = &quot;&lt;script&gt;alert('I like HTML injection')&lt;/script&gt;&quot; in
txt ~raw:true &quot;%s&quot; user_input</code></pre></div></div><div class="odoc-spec"><div class="spec value" id="val-comment" class="anchored"><a href="#val-comment" class="anchor"></a><code><span><span class="keyword">val</span> comment : <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-node">node</a></span></code></div><div class="spec-doc"><p>A comment that will be embedded in the rendered HTML, i.e. <code>&lt;!-- comment --&gt;</code>. The text is HTML-escaped.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-csrf_tag" class="anchored"><a href="#val-csrf_tag" class="anchor"></a><code><span><span class="keyword">val</span> csrf_tag : <span><span class="xref-unresolved">Dream</span>.request <span class="arrow">&#45;&gt;</span></span> <a href="#type-node">node</a></span></code></div><div class="spec-doc"><p>Convenience to add a CSRF token generated by Dream into your form. Type-safe wrapper for <code>Dream.csrf_tag</code>.</p><pre><code>Tag.form
  [action &quot;/foo&quot;]
  [csrf_tag req; input [name &quot;bar&quot;]; input [type_ &quot;submit&quot;]]</code></pre></div></div><h3 id="accessors-for-tags"><a href="#accessors-for-tags" class="anchor"></a>Accessors for tags</h3><div class="odoc-spec"><div class="spec value" id="val-(+@)" class="anchored"><a href="#val-(+@)" class="anchor"></a><code><span><span class="keyword">val</span> (+@) : <span><a href="#type-node">node</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-attr">attr</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-node">node</a></span></code></div><div class="spec-doc"><p>Add an attribute to a tag.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if the node is not a tag (i.e. if it is a text or comment node).</p></li></ul><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 0.0.3.</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-(-@)" class="anchored"><a href="#val-(-@)" class="anchor"></a><code><span><span class="keyword">val</span> (-@) : <span><a href="#type-node">node</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-node">node</a></span></code></div><div class="spec-doc"><p>Remove an attribute from a tag.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if the node is not a tag (i.e. if it is a text or comment node).</p></li></ul><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 0.0.3.</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-(.@[])" class="anchored"><a href="#val-(.@[])" class="anchor"></a><code><span><span class="keyword">val</span> (.@[]) : <span><a href="#type-node">node</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Get the value of an existing attribute.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Invalid_argument</span> <p>if the node is not a tag (i.e. if it is a text or comment node).</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Not_found</span> <p>if the tag does not have the given attribute.</p></li></ul><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 0.0.3.</li></ul><pre><code>let toast = p [id &quot;toast&quot;] [txt &quot;OK.&quot;]
let toast_id = toast.@[&quot;id&quot;]</code></pre></div></div><h3 id="standard-attributes"><a href="#standard-attributes" class="anchor"></a>Standard attributes</h3><div class="odoc-spec"><div class="spec module" id="module-Attr" class="anchored"><a href="#module-Attr" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Attr/index.html">Attr</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Standard, most non-deprecated attributes from <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes">https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes</a>. Where an attribute name conflicts with an OCaml keyword, the name is suffixed with <code>_</code>. Most attributes are constructed by passing in a value of some type.</p></div></div><h3 id="standard-tags"><a href="#standard-tags" class="anchor"></a>Standard tags</h3><div class="odoc-spec"><div class="spec module" id="module-Tag" class="anchored"><a href="#module-Tag" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Tag/index.html">Tag</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>HTML tags. Most (standard tags) are constructed by passing a list of attributes and a list of children:</p></div></div><h3 id="htmx-attributes"><a href="#htmx-attributes" class="anchor"></a>htmx attributes</h3><div class="odoc-spec"><div class="spec module" id="module-Hx" class="anchored"><a href="#module-Hx" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Hx/index.html">Hx</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>htmx attributes <a href="https://htmx.org/reference/#attributes">https://htmx.org/reference/#attributes</a></p></div></div><h3 id="interop-example–markdown-to-html"><a href="#interop-example–markdown-to-html" class="anchor"></a>Interop example–Markdown to HTML</h3><p>In this section we show an extended example of interoperability of dream-html with other formats, e.g. the Markdown format defined by the <code>omd</code> library:</p><pre><code>open Dream_html
open Tag
open Attr

let omd_attr (k, opt_v) =
  string_attr k &quot;%s&quot; @@ Option.fold ~none:&quot;&quot; ~some:Fun.id opt_v

let rec omd_node elements = elements |&gt; List.map element_node |&gt; Tag.null
and item omd = li [] [omd_node omd]

and element_node = function
  | Omd.H1 omd -&gt; h1 [] [omd_node omd]
  | H2 omd -&gt; h2 [] [omd_node omd]
  | H3 omd -&gt; h3 [] [omd_node omd]
  | H4 omd -&gt; h4 [] [omd_node omd]
  | H5 omd -&gt; h5 [] [omd_node omd]
  | H6 omd -&gt; h6 [] [omd_node omd]
  | Paragraph omd -&gt; p [] [omd_node omd]
  | Text str -&gt; txt &quot;%s&quot; str
  | Emph omd -&gt; em [] [omd_node omd]
  | Bold omd -&gt; b [] [omd_node omd]
  | Ul omds | Ulp omds -&gt; ul [] @@ List.map item omds
  | Ol omds | Olp omds -&gt; ol [] @@ List.map item omds
  | Code (cls, str) -&gt; code [class_ &quot;%s&quot; cls] [txt &quot;%s&quot; str]
  | Code_block (cls, str) -&gt;
    pre [class_ &quot;%s&quot; cls] [code [class_ &quot;%s&quot; cls] [txt &quot;%s&quot; str]]
  | Br -&gt; br []
  | Hr -&gt; hr []
  | NL -&gt; txt &quot;\n&quot;
  | Url (hre, omd, titl) -&gt;
    a
      [ href &quot;%s&quot; hre;
        target &quot;_blank&quot;;
        class_ &quot;after:content-['_↗️']&quot;;
        title &quot;%s&quot; titl ]
      [omd_node omd]
  | Html (&quot;details&quot;, attrs, omd) -&gt;
    details (List.map omd_attr attrs) [omd_node omd]
  | Html (&quot;summary&quot;, attrs, omd) -&gt;
    summary (List.map omd_attr attrs) [omd_node omd]
  | Html_block (&quot;details&quot;, attrs, omd) -&gt;
    details (List.map omd_attr attrs) [omd_node omd]
  | Html_block (&quot;summary&quot;, attrs, omd) -&gt;
    summary (List.map omd_attr attrs) [omd_node omd]
  | Ref (_, _, _, _)
  | Img_ref (_, _, _, _)
  | Html (_, _, _)
  | Html_block (_, _, _)
  | X _ -&gt; Tag.null []
  | Html_comment str -&gt; comment str
  | Raw str -&gt; txt ~raw:true &quot;%s&quot; str
  | Raw_block str -&gt; pre [] [txt ~raw:true &quot;%s&quot; str]
  | Blockquote omd -&gt; blockquote [] [omd_node omd]
  | Img (al, sr, titl) -&gt; img [alt &quot;%s&quot; al; src &quot;%s&quot; sr; title &quot;%s&quot; titl]</code></pre><p>The entrypoint of the functionality is the <code>omd_node</code> function, which converts from the <code>Omd.t</code> value which can be obtained by, for example, parsing Markdown with the <code>Omd.of_string</code> function, to a type-safe <code>node</code> value.</p><p>In the <code>element_node</code> function we traverse the Markdown structure and convert it into specific nodes–tags, comments, etc.. Text is escaped as appropriate and some specific conversions are handled specially:</p><ul><li>All hyperlinks are made to open new tabs and suffixed using a Tailwind CSS style class.</li><li>We support the <code>&lt;details&gt;</code> and <code>&lt;summary&gt;</code> HTML tags, but no others.</li></ul><p>This is just an example, but it shows the idea that we can take various formats and interop with them using type-sdfe HTML generated by dream-html.</p></div></body></html>